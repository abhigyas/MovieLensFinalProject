<!-- templates/visualize.html -->
{% extends "base.html" %}
{% block content %}
<div class="visualizations-container">
    <h2 class="text-center mb-4">Model Training Progress</h2>
    <div class="plot-container">
        <div id="trainingPlot"></div>
    </div>
</div>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    try {
        // Create traces directly
        const traces = [
            {
                x: {{ epochs | tojson }},
                y: {{ train_losses | tojson }},
                type: 'scatter',
                mode: 'lines+markers',
                name: 'Training Loss'
            },
            {
                x: {{ epochs | tojson }},
                y: {{ val_losses | tojson }},
                type: 'scatter',
                mode: 'lines+markers',
                name: 'Validation Loss'
            }
        ];

        const layout = {
            title: 'Model Training Progress',
            xaxis: {title: 'Epoch'},
            yaxis: {title: 'Loss'}
        };

        const config = {
            responsive: true,
            displayModeBar: true
        };

        Plotly.newPlot('trainingPlot', traces, layout, config)
            .catch(err => {
                console.error('Plot error:', err);
                document.getElementById('trainingPlot').innerHTML = 
                    '<div class="alert alert-danger">Failed to create plot</div>';
            });

    } catch (error) {
        console.error('Plot initialization error:', error);
        document.getElementById('trainingPlot').innerHTML = 
            '<div class="alert alert-danger">Failed to initialize plot</div>';
    }
});
</script>

<style>
.plot-container {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    margin: 20px 0;
}

#trainingPlot {
    width: 100%;
    height: 500px;
}
</style>
{% endblock %}